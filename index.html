<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PadelBoard - App</title>
  <link rel="stylesheet" href="./app.css" />
</head>

<body class="min-h-full bg-gray-50">
  <!-- Contenido Principal -->
  <div class="main-content">
    <!-- Pesta√±a 1: Configurador -->
    <div id="configurador-tab" class="content-section active">
      <div class="py-8 px-4">
        <div class="max-w-4xl mx-auto">
          <!-- Header -->
          <div class="text-center mb-8">
            <div class="flex items-center justify-center mb-4">
              <img src="./logo_padelboard.png" alt="Logo PadelBoard" class="app-logo" />
            </div>
            <h1 class="text-3xl font-bold text-white mb-3">Configurador de Partido</h1>
            <p class="text-lg text-white opacity-90">
              Configura tu partido de p√°del con todos los detalles. Elige el formato, sistema de puntuaci√≥n y m√°s.
            </p>
          </div>

          <!-- Formulario Principal -->
          <div class="bg-white rounded-2xl shadow-xl p-8">
            <form id="configuracionForm">
              <!-- Jugadores -->
              <div class="mb-8">
                <h2 class="text-3xl font-bold text-gray-800 mb-6 flex items-center justify-center">
                  Jugadores
                </h2>

                <div>
                  <div class="pair-card mb-4">
                    <div class="pair-header">
                      <h3>Pareja 1</h3>
                    </div>
                    <div class="pair-body">
                      <input
                        type="text"
                        id="jugador1"
                        name="jugador1"
                        class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none transition-colors"
                        placeholder="Jugador 1"
                        autocomplete="off"
                      />

                      <input
                        type="text"
                        id="jugador2"
                        name="jugador2"
                        class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none transition-colors"
                        placeholder="Jugador 2"
                        autocomplete="off"
                      />
                    </div>
                  </div>

                  <div class="pair-card">
                    <div class="pair-header">
                      <h3>Pareja 2</h3>
                    </div>
                    <div class="pair-body">
                      <input
                        type="text"
                        id="jugador3"
                        name="jugador3"
                        class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none transition-colors"
                        placeholder="Jugador 3"
                        autocomplete="off"
                      />

                      <input
                        type="text"
                        id="jugador4"
                        name="jugador4"
                        class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none transition-colors"
                        placeholder="Jugador 4"
                        autocomplete="off"
                      />
                    </div>
                  </div>
                </div>
              </div>

              <!-- Tipo de Juego -->
              <div class="mb-8">
                <h2 class="text-3xl font-bold text-gray-800 mb-6 flex items-center justify-center">
                  Tipo de Juego
                </h2>

                <div class="game-type-summary-card">
                  <div>
                    <h3 id="game-type-summary-title">Al mejor de 3</h3>
                    <p id="game-type-summary-desc">Formato cl√°sico (por defecto)</p>
                  </div>
                  <button type="button" class="change-button" onclick="openGameTypeModal()">
                    Cambiar
                  </button>
                </div>

                <!-- Pr√≥ximamente -->
                <div class="bg-gray-100 rounded-xl p-6 opacity-70 hidden">
                  <div class="flex items-center justify-between">
                    <div>
                      <h3 class="font-bold text-lg mb-2 flex items-center">Juego Personalizado</h3>
                      <p class="text-gray-600 text-sm">Elige la cantidad de games (1-8)</p>
                    </div>
                    <div class="flex items-center space-x-3">
                      <label class="text-sm font-medium text-gray-700">Games:</label>
                      <select
                        id="customGames"
                        onchange="selectCustomGames()"
                        class="px-3 py-2 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none input-disabled"
                        disabled
                      >
                        <option value="">Pr√≥ximamente</option>
                        <option value="1">1 game</option>
                        <option value="2">2 games</option>
                        <option value="3">3 games</option>
                        <option value="4">4 games</option>
                        <option value="5">5 games</option>
                        <option value="6">6 games</option>
                        <option value="7">7 games</option>
                        <option value="8">8 games</option>
                      </select>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Sistema de Puntuaci√≥n -->
              <div class="mb-8">
                <h2 class="text-3xl font-bold text-gray-800 mb-6 flex items-center justify-center">
                  Sistema de Puntuaci√≥n
                </h2>
                <div class="segmented-control">
                  <button
                    type="button"
                    id="scoring-golden"
                    class="segment-button"
                    onclick="selectScoring('golden', this)"
                  >
                    Punto de Oro
                  </button>
                  <button
                    type="button"
                    id="scoring-advantage"
                    class="segment-button"
                    onclick="selectScoring('advantage', this)"
                  >
                    Con Ventaja
                  </button>
                </div>
              </div>

              <!-- Cambio de Lado -->
              <div class="mb-8">
                <h2 class="text-3xl font-bold text-gray-800 mb-6 flex items-center justify-center">
                  Cambio de Lado
                </h2>
                <div class="segmented-control">
                  <button
                    type="button"
                    id="side-odd"
                    class="segment-button"
                    onclick="selectSideChange('odd', this)"
                  >
                    Juegos Impares
                  </button>
                  <button
                    type="button"
                    id="side-set"
                    class="segment-button"
                    onclick="selectSideChange('set', this)"
                  >
                    Final de Set
                  </button>
                  <button
                    type="button"
                    id="side-none"
                    class="segment-button"
                    onclick="selectSideChange('none', this)"
                  >
                    Sin Cambio
                  </button>
                </div>
              </div>

              <!-- M√©todo de Conteo (oculto por ahora) -->
              <div class="mb-8 hidden">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center justify-center">
                  M√©todo de Conteo
                </h2>
                <div class="segmented-control">
                  <button
                    type="button"
                    id="counting-players"
                    class="segment-button"
                    onclick="selectCountingMethod('players', this)"
                  >
                    Modo Jugadores
                  </button>
                  <button
                    type="button"
                    id="counting-referee"
                    class="segment-button"
                    onclick="selectCountingMethod('referee', this)"
                  >
                    Modo √Årbitro
                  </button>
                </div>
              </div>

              <!-- Modo Torneo -->
              <div class="mb-8">
                <label class="tournament-card">
                  <input type="checkbox" id="tournamentMode" class="custom-checkbox-input" />
                  <div class="w-full">
                    <div class="flex items-center">
                      <h3
                        class="font-bold text-lg text-gray-800"
                        style="margin-right: 15px; margin-bottom: 18px;"
                      >
                        Modo Torneo
                      </h3>
                      <div class="checkmark-box"></div>
                    </div>
                    <p class="text-gray-600 text-xs leading-tight" style="margin-top: -10px;">
                      Cambio de lado obligatorio en Tie-breaks <br />
                      (cada 6 pts)
                    </p>
                  </div>
                </label>
              </div>

              <!-- Botones de Acci√≥n -->
              <div class="flex flex-col sm:flex-row gap-4">
                <button
                  type="button"
                  onclick="openConfirmModal(event)"
                  class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-8 rounded-xl text-lg transition-colors"
                >
                  Iniciar Partido
                </button>
                <button
                  type="button"
                  onclick="resetConfig()"
                  class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-bold py-4 px-8 rounded-xl text-lg transition-colors"
                >
                  Reiniciar Configuraci√≥n
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- Pesta√±a 2: Estad√≠sticas -->
    <div id="stats-tab" class="content-section">
      <div class="py-8 px-4">
        <div class="max-w-4xl mx-auto">
          <!-- Header -->
          <div class="text-center mb-8">
            <div class="flex items-center justify-center mb-4">
              <img src="./logo_padelboard.png" alt="Logo PadelBoard" class="app-logo" />
            </div>
            <h1 class="text-3xl font-bold text-white mb-3">Estad√≠sticas de Rendimiento</h1>
            <p class="text-lg text-white opacity-90">
              Revisa tu progreso y analiza tu juego. Todas las estad√≠sticas de tus partidos guardados.
            </p>
          </div>

          <!-- Contenido Principal -->
          <div class="bg-white rounded-2xl shadow-xl p-8">
            <!-- Contenido sin login -->
            <div id="stats-no-login" class="text-center py-12">
              <div class="mb-8">
                <svg class="mx-auto h-24 w-24 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"
                  />
                </svg>
              </div>
              <h2 class="text-2xl font-bold text-gray-800 mb-6">Inicia sesi√≥n para ver tus estad√≠sticas</h2>
              <p class="text-lg text-gray-600 mb-8">
                Registra tus partidos y accede a an√°lisis detallados de tu rendimiento. Todas las estad√≠sticas se guardan autom√°ticamente cuando juegas con sesi√≥n iniciada.
              </p>
              <button
                onclick="showLoginForm()"
                class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-8 rounded-xl text-lg transition-colors"
                type="button"
              >
                Iniciar Sesi√≥n
              </button>
            </div>

            <!-- App M√≥vil -->
            <div class="mt-8">
              <div class="bg-gradient-to-r from-blue-50 to-blue-100 rounded-xl p-6 text-center">
                <div class="mb-4">
                  <svg class="w-16 h-16 mx-auto text-blue-600 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"
                    ></path>
                  </svg>
                  <h3 class="text-xl font-bold text-blue-800 mb-2">PadelBoard M√≥vil</h3>
                  <p class="text-blue-600 mb-6">Lleva tus partidos contigo. Sincroniza autom√°ticamente tus estad√≠sticas.</p>
                </div>
                <button
                  onclick="downloadApp()"
                  class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-xl transition-colors"
                  type="button"
                >
                  Descargar App M√≥vil
                </button>
              </div>
            </div>

            <!-- Contenido con login -->
            <div id="stats-with-login" class="hidden">
              <!-- Resumen General -->
              <div class="mb-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center justify-center">Resumen General</h2>
                <div class="grid md:grid-cols-2 gap-6">
                  <div class="bg-gradient-to-r from-blue-50 to-blue-100 rounded-xl p-6 text-center">
                    <h3 class="text-3xl font-bold text-blue-800 mb-2">24</h3>
                    <p class="text-blue-600 font-medium">Partidos Jugados</p>
                  </div>
                  <div class="bg-gradient-to-r from-blue-50 to-blue-100 rounded-xl p-6 text-center">
                    <h3 class="text-3xl font-bold text-blue-800 mb-2">67%</h3>
                    <p class="text-blue-600 font-medium">Porcentaje de Victorias</p>
                  </div>
                  <div class="bg-gradient-to-r from-blue-50 to-blue-100 rounded-xl p-6 text-center">
                    <h3 class="text-3xl font-bold text-blue-800 mb-2">1,247</h3>
                    <p class="text-blue-600 font-medium">Puntos Totales</p>
                  </div>
                </div>
              </div>

              <!-- Estad√≠sticas Detalladas -->
              <div class="mb-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center justify-center">Estad√≠sticas Detalladas</h2>
                <div class="grid md:grid-cols-2 gap-6">
                  <div class="bg-white rounded-xl p-6 border-2 border-gray-200">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Rendimiento por Set</h3>
                    <div class="space-y-3">
                      <div class="flex justify-between items-center">
                        <span class="text-gray-700">Sets ganados</span>
                        <span class="font-bold text-blue-600">32</span>
                      </div>
                      <div class="flex justify-between items-center">
                        <span class="text-gray-700">Sets perdidos</span>
                        <span class="font-bold text-gray-600">16</span>
                      </div>
                      <div class="flex justify-between items-center">
                        <span class="text-gray-700">Porcentaje de sets</span>
                        <span class="font-bold text-blue-600">67%</span>
                      </div>
                    </div>
                  </div>

                  <div class="bg-white rounded-xl p-6 border-2 border-gray-200">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Rendimiento por Game</h3>
                    <div class="space-y-3">
                      <div class="flex justify-between items-center">
                        <span class="text-gray-700">Games ganados</span>
                        <span class="font-bold text-blue-600">156</span>
                      </div>
                      <div class="flex justify-between items-center">
                        <span class="text-gray-700">Games perdidos</span>
                        <span class="font-bold text-gray-600">98</span>
                      </div>
                      <div class="flex justify-between items-center">
                        <span class="text-gray-700">Porcentaje de games</span>
                        <span class="font-bold text-blue-600">61%</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Historial de Partidos -->
              <div class="mb-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center justify-center">√öltimos Partidos</h2>
                <div class="bg-white rounded-xl p-6 border-2 border-gray-200">
                  <div class="space-y-4">
                    <div class="flex justify-between items-center p-4 bg-gray-50 rounded-lg">
                      <div>
                        <span class="font-bold text-gray-800">Juan & Pedro vs Carlos & Ana</span>
                        <p class="text-sm text-gray-600">Hace 2 d√≠as - Club Deportivo</p>
                      </div>
                      <span class="font-bold text-green-600 text-lg">6-4, 6-2</span>
                    </div>

                    <div class="flex justify-between items-center p-4 bg-gray-50 rounded-lg">
                      <div>
                        <span class="font-bold text-gray-800">Mar√≠a & Luis vs Sofia & Diego</span>
                        <p class="text-sm text-gray-600">Hace 5 d√≠as - Polideportivo Norte</p>
                      </div>
                      <span class="font-bold text-red-600 text-lg">4-6, 3-6</span>
                    </div>

                    <div class="flex justify-between items-center p-4 bg-gray-50 rounded-lg">
                      <div>
                        <span class="font-bold text-gray-800">Alex & Carmen vs Roberto & Elena</span>
                        <p class="text-sm text-gray-600">Hace 1 semana - Centro Deportivo</p>
                      </div>
                      <span class="font-bold text-green-600 text-lg">7-5, 6-4</span>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Bot√≥n Ver M√°s -->
              <div class="text-center">
                <button
                  onclick="showFullStats()"
                  class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-8 rounded-xl text-lg transition-colors"
                  type="button"
                >
                  Ver Historial Completo
                </button>
              </div>
            </div>
          </div>
          <!-- /Contenido Principal -->
        </div>
      </div>
    </div>

    <!-- Pesta√±a 3: Perfil -->
    <div id="perfil-tab" class="content-section">
      <div class="py-8 px-4">
        <div class="max-w-4xl mx-auto">
          <!-- Header -->
          <div class="text-center mb-8">
            <div class="flex items-center justify-center mb-4">
              <img src="./logo_padelboard.png" alt="Logo PadelBoard" class="app-logo" />
            </div>
            <h1 class="text-3xl font-bold text-white mb-3">Gesti√≥n de Perfil</h1>
            <p class="text-lg text-white opacity-90">
              Administra tu cuenta, configuraciones y preferencias. Inicia sesi√≥n para acceder a todas las funciones.
            </p>
          </div>

          <!-- Contenido Principal -->
          <div class="bg-white rounded-2xl shadow-xl p-8">
            <!-- Formulario de Login -->
            <div id="login-form">
              <div class="text-center mb-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Iniciar Sesi√≥n</h2>
                <p class="text-gray-600">Accede a tu cuenta para ver estad√≠sticas y configuraciones</p>
              </div>

              <form onsubmit="handleLogin(event)" class="max-w-md mx-auto">
                <div class="mb-6">
                  <label for="email" class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                  <input
                    type="email"
                    id="email"
                    name="email"
                    required
                    class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none transition-colors"
                    placeholder="tu@email.com"
                  />
                </div>

                <div class="mb-6">
                  <label for="password" class="block text-sm font-medium text-gray-700 mb-2">Contrase√±a</label>
                  <input
                    type="password"
                    id="password"
                    name="password"
                    required
                    class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none transition-colors"
                    placeholder="Tu contrase√±a"
                  />
                </div>

                <button
                  type="submit"
                  class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-8 rounded-xl text-lg transition-colors mb-4"
                >
                  Iniciar Sesi√≥n
                </button>

                <div class="text-center">
                  <p class="text-gray-600 mb-4">¬øNo tienes cuenta?</p>
                  <button type="button" onclick="showRegisterForm()" class="text-blue-600 hover:text-blue-700 font-medium">
                    Crear cuenta nueva
                  </button>
                </div>
              </form>
            </div>

            <!-- Formulario de Registro -->
            <div id="register-form" class="hidden">
              <div class="text-center mb-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Crear Cuenta</h2>
                <p class="text-gray-600">Reg√≠strate para guardar tus estad√≠sticas y configuraciones</p>
              </div>

              <form onsubmit="handleRegister(event)" class="max-w-md mx-auto">
                <div class="mb-6">
                  <label for="reg-name" class="block text-sm font-medium text-gray-700 mb-2">Nombre completo</label>
                  <input
                    type="text"
                    id="reg-name"
                    name="name"
                    required
                    class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none transition-colors"
                    placeholder="Tu nombre completo"
                  />
                </div>

                <div class="mb-6">
                  <label for="reg-email" class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                  <input
                    type="email"
                    id="reg-email"
                    name="email"
                    required
                    class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none transition-colors"
                    placeholder="tu@email.com"
                  />
                </div>

                <div class="mb-6">
                  <label for="reg-password" class="block text-sm font-medium text-gray-700 mb-2">Contrase√±a</label>
                  <input
                    type="password"
                    id="reg-password"
                    name="password"
                    required
                    class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none transition-colors"
                    placeholder="M√≠nimo 6 caracteres"
                  />
                </div>

                <button
                  type="submit"
                  class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-8 rounded-xl text-lg transition-colors mb-4"
                >
                  Crear Cuenta
                </button>

                <div class="text-center">
                  <p class="text-gray-600 mb-4">¬øYa tienes cuenta?</p>
                  <button type="button" onclick="showLoginForm()" class="text-blue-600 hover:text-blue-700 font-medium">
                    Iniciar sesi√≥n
                  </button>
                </div>
              </form>
            </div>

            <!-- Perfil de usuario -->
            <div id="user-profile" class="hidden">
              <!-- Informaci√≥n del Usuario -->
              <div class="mb-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center justify-center">Informaci√≥n Personal</h2>
                <div class="text-center mb-6">
                  <div class="w-24 h-24 bg-gradient-to-r from-blue-50 to-blue-100 rounded-full mx-auto mb-4 flex items-center justify-center border-4 border-blue-200">
                    <span class="text-2xl font-bold text-blue-600" id="user-initials">ND</span>
                  </div>
                  <h3 class="text-xl font-bold text-gray-800" id="user-name">Nicolas Davila</h3>
                  <p class="text-gray-600" id="user-email">nicolas.davila@email.com</p>
                </div>
              </div>

              <!-- Acciones -->
              <div class="space-y-4">
                <button
                  onclick="handleLogout()"
                  class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-4 px-8 rounded-xl text-lg transition-colors"
                  type="button"
                >
                  Cerrar Sesi√≥n
                </button>
              </div>
            </div>

          </div>
          <!-- /Contenido Principal -->
        </div>
      </div>
    </div>
  </div>
  <!-- /main-content -->

  <!-- Banner de Descarga Inferior -->
  <div
    id="download-banner"
    class="bg-blue-600 text-white py-3 px-4 text-center relative hidden"
    style="position: fixed; bottom: 60px; left: 0; right: 0; z-index: 40;"
  >
    <div class="flex items-center justify-center space-x-4">
      <div class="flex items-center space-x-2">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
        </svg>
        <span class="text-sm font-medium">¬°Descarga la App M√≥vil de PadelBoard!</span>
      </div>
      <button
        onclick="downloadApp()"
        class="bg-white text-blue-600 px-4 py-1 rounded-full text-sm font-bold hover:bg-gray-100 transition-colors"
        type="button"
      >
        Descargar
      </button>
    </div>
    <button
      onclick="document.getElementById('download-banner').classList.add('hidden')"
      class="absolute right-4 top-1/2 transform -translate-y-1/2 text-white hover:text-gray-200"
      type="button"
      aria-label="Cerrar"
    >
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
      </svg>
    </button>
  </div>

  <!-- Navegaci√≥n Inferior -->
  <div class="bottom-nav">
    <div class="flex">
      <button onclick="switchTab('configurador')" id="tab-configurador"
        class="flex-1 py-4 px-2 text-center tab-active transition-colors" type="button">
        <div class="flex flex-col items-center">
          <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
          </svg>
          <span class="text-xs font-medium">Configurar</span>
        </div>
      </button>

      <button onclick="switchTab('stats')" id="tab-stats"
        class="flex-1 py-4 px-2 text-center tab-inactive transition-colors" type="button">
        <div class="flex flex-col items-center">
          <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
          </svg>
          <span class="text-xs font-medium">Estad√≠sticas</span>
        </div>
      </button>

      <button onclick="switchTab('perfil')" id="tab-perfil"
        class="flex-1 py-4 px-2 text-center tab-inactive transition-colors" type="button">
        <div class="flex flex-col items-center">
          <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
          </svg>
          <span class="text-xs font-medium">Perfil</span>
        </div>
      </button>
    </div>
  </div>

  <!-- Modal Tipo de Juego -->
  <div id="gameTypeModal" class="modal-overlay hidden" onclick="handleOverlayClose(event, 'gameTypeModal')">
    <div class="modal-content" onclick="event.stopPropagation()">
      <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">Selecciona un Formato de Juego</h2>

      <div class="game-type-button-list">
        <button type="button" onclick="selectGameTypeFromModal(event, '3sets', 'Al mejor de 3', 'Formato cl√°sico (por defecto)')">
          <h3>Al mejor de 3</h3>
          <p>Partidos est√°ndar (1-3 sets)</p>
        </button>

        <button type="button" onclick="selectGameTypeFromModal(event, '2sets-super', '2 Sets + Super Tie', 'Formato de torneo (tie-break a 10)')">
          <h3>2 Sets + Super Tie</h3>
          <p>Formato de torneo (tie-break a 10)</p>
        </button>

        <button type="button" onclick="selectGameTypeFromModal(event, '1set', '1 Set', 'Partido √∫nico')">
          <h3>1 Set</h3>
          <p>Un solo set, ideal para partidos r√°pidos</p>
        </button>

        <button type="button" onclick="selectGameTypeFromModal(event, 'tiebreak', 'Solo Tie-break', 'Gana el primero en llegar a 7 puntos')">
          <h3>Solo Tie-break</h3>
          <p>Gana el primero en llegar a 7 puntos</p>
        </button>

        <button type="button" onclick="selectGameTypeFromModal(event, 'super-tiebreak', 'Super Tie-break', 'Gana el primero en llegar a 10 puntos')">
          <h3>Super Tie-break</h3>
          <p>Gana el primero en llegar a 10 puntos</p>
        </button>

        <button type="button" onclick="selectGameTypeFromModal(event, 'quick', 'Juego R√°pido', 'Un set corto a 4 games')">
          <h3>Juego R√°pido</h3>
          <p>Un set corto a 4 games</p>
        </button>
      </div>

      <div class="modal-actions">
        <button type="button" onclick="closeGameTypeModal()"
          class="w-full bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-xl text-lg transition-colors">
          Cancelar
        </button>
      </div>
    </div>
  </div>

  <!-- Modal Resumen del Partido -->
  <div id="confirmModal" class="modal-overlay hidden" onclick="handleOverlayClose(event, 'confirmModal')">
    <div class="modal-content" onclick="event.stopPropagation()">
      <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">Resumen del Partido</h2>

      <div id="configSummaryList" class="summary-list">
        <div class="summary-group">
          <h3 class="summary-title">Equipos</h3>
          <div id="teams-summary" class="summary-details"></div>
        </div>

        <div class="summary-group">
          <h3 class="summary-title">Formato</h3>
          <div id="format-summary" class="summary-details"></div>
        </div>
      </div>

      <div class="modal-actions">
        <button type="button" onclick="closeConfirmModal()"
          class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-xl text-lg transition-colors">
          Cancelar
        </button>
        <button type="button" onclick="startMatch()"
          class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-xl text-lg transition-colors">
          Confirmar e Iniciar
        </button>
      </div>
    </div>
  </div>

  <!-- MQTT lib -->
  <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>

  <script>
    // =========================
    // MQTT (HiveMQ Cloud) - PB2
    // =========================
    let mqttClient = null;
    let mqttConnected = false;

    const MQTT_CFG = {
      url: "wss://8710939c545d4dc7adc1804a0bd323fb.s1.eu.hivemq.cloud:8884/mqtt",
      username: "padelboard_pb2",
      password: "Aqeria123",
      topicConfig: "padelboard/PB2/config",
      topicAck: "padelboard/PB2/ack" // opcional
    };

    function mqttConnect() {
      try {
        mqttClient = mqtt.connect(MQTT_CFG.url, {
          username: MQTT_CFG.username,
          password: MQTT_CFG.password,
          keepalive: 60,
          clean: true,
          reconnectPeriod: 2000,
          connectTimeout: 8000,
          clientId: "pb2-web-" + Math.random().toString(16).slice(2)
        });

        mqttClient.on("connect", () => {
          mqttConnected = true;
          console.log("‚úÖ MQTT conectado a HiveMQ Cloud");

          // opcional ACK:
          mqttClient.subscribe(MQTT_CFG.topicAck, { qos: 0 }, () => {
            console.log("üì© Suscrito a:", MQTT_CFG.topicAck);
          });
        });

        mqttClient.on("reconnect", () => console.log("‚ôªÔ∏è MQTT reconectando..."));
        mqttClient.on("close", () => { mqttConnected = false; console.log("‚ö†Ô∏è MQTT desconectado"); });
        mqttClient.on("error", (e) => { mqttConnected = false; console.error("‚ùå MQTT error:", e); });

        mqttClient.on("message", (topic, msg) => {
          console.log("üì® MQTT mensaje", topic, msg.toString());
          if (topic === MQTT_CFG.topicAck) {
            alert("‚úÖ Marcador confirm√≥ recepci√≥n:\n" + msg.toString());
          }
        });
      } catch (e) {
        console.error("‚ùå Error iniciando MQTT:", e);
      }
    }

    function mqttSendConfig(payloadObj) {
      if (!mqttClient || !mqttConnected) {
        console.warn("‚ö†Ô∏è MQTT no conectado a√∫n");
        return false;
      }
      const payload = JSON.stringify(payloadObj);
      mqttClient.publish(MQTT_CFG.topicConfig, payload, { qos: 0, retain: false });
      console.log("‚úÖ Publicado a", MQTT_CFG.topicConfig, payload);
      return true;
    }

    async function sendLocalConfig(params) {
      const apiUrl = `http://192.168.4.1/api/names?${params.toString()}`;
      await fetch(apiUrl, { mode: "no-cors" });
      return true;
    }

    // =========================
    // Estado global
    // =========================
    let config = {
      players: {},
      gameType: "3sets",
      scoring: "golden",
      countingMethod: "players",
      sideChange: "set",
      tournamentMode: false,
    };

    let isLoggedIn = false;
    let currentUser = null;

    // =========================
    // Utilidades UI
    // =========================
    function handleOverlayClose(evt, modalId) {
      if (evt.target && evt.target.id === modalId) {
        if (modalId === "gameTypeModal") closeGameTypeModal();
        if (modalId === "confirmModal") closeConfirmModal();
      }
    }

    function setSegmentSelected(groupSelector, selectedId) {
      document.querySelectorAll(groupSelector).forEach((btn) => btn.classList.remove("selected"));
      const el = document.getElementById(selectedId);
      if (el) el.classList.add("selected");
    }

    // =========================
    // Descarga App (demo)
    // =========================
    function downloadApp() {
      const downloadOptions = `
Descarga PadelBoard App

Elige tu plataforma:

üì± iOS (App Store)
ü§ñ Android (Google Play)
üíª Versi√≥n de Escritorio

Beneficios de la app m√≥vil:
‚Ä¢ Marcador offline sin conexi√≥n a internet
‚Ä¢ Sincronizaci√≥n autom√°tica de estad√≠sticas
‚Ä¢ Notificaciones de partidos programados
‚Ä¢ An√°lisis avanzado de rendimiento
‚Ä¢ Interfaz optimizada para m√≥viles

¬øEn qu√© dispositivo quieres instalarla?
      `;

      if (confirm(downloadOptions)) {
        alert("üöÄ ¬°Genial! (Demo) Aqu√≠ se abrir√≠a el link real de descarga.");
      }
    }

    // =========================
    // Modal Tipo de Juego
    // =========================
    function openGameTypeModal() {
      document.body.classList.add("modal-open");
      const modal = document.getElementById("gameTypeModal");
      modal.classList.remove("hidden");

      document.querySelectorAll("#gameTypeModal .game-type-button-list button").forEach((btn) => {
        btn.classList.remove("selected");
      });

      const currentType = config.gameType;
      const currentButton = document.querySelector(`#gameTypeModal button[onclick*="'${currentType}'"]`);
      if (currentButton) currentButton.classList.add("selected");
    }

    function closeGameTypeModal() {
      document.body.classList.remove("modal-open");
      document.getElementById("gameTypeModal").classList.add("hidden");
    }

    function selectGameTypeFromModal(evt, type, title, desc) {
      config.gameType = type;

      document.querySelectorAll("#gameTypeModal .game-type-button-list button").forEach((btn) => btn.classList.remove("selected"));
      const clicked = evt && evt.currentTarget ? evt.currentTarget : null;
      if (clicked) clicked.classList.add("selected");

      document.getElementById("game-type-summary-title").textContent = title;
      document.getElementById("game-type-summary-desc").textContent = desc;

      closeGameTypeModal();
      updateSummary();
    }

    // =========================
    // Selecciones configurador
    // =========================
    function selectScoring(type, element) {
      config.scoring = type;
      const parent = element.parentElement;
      parent.querySelectorAll(".segment-button").forEach((btn) => btn.classList.remove("selected"));
      element.classList.add("selected");
      updateSummary();
    }

    function selectCountingMethod(type, element) {
      config.countingMethod = type;
      const parent = element.parentElement;
      parent.querySelectorAll(".segment-button").forEach((btn) => btn.classList.remove("selected"));
      element.classList.add("selected");
      updateSummary();
    }

    function selectSideChange(type, element) {
      config.sideChange = type;
      const parent = element.parentElement;
      parent.querySelectorAll(".segment-button").forEach((btn) => btn.classList.remove("selected"));
      element.classList.add("selected");
      updateSummary();
    }

    function selectCustomGames() {
      const customGames = document.getElementById("customGames").value;
      if (customGames) {
        config.gameType = `custom-${customGames}`;
        updateSummary();
      }
    }

    // =========================
    // Resumen modal
    // =========================
    function updateSummary() {
      const players = {
        jugador1: (document.getElementById("jugador1").value || "").trim() || "Jugador 1",
        jugador2: (document.getElementById("jugador2").value || "").trim() || "Jugador 2",
        jugador3: (document.getElementById("jugador3").value || "").trim() || "Jugador 3",
        jugador4: (document.getElementById("jugador4").value || "").trim() || "Jugador 4",
      };

      const gameTypes = {
        "1set": "1 Set",
        "3sets": "Al mejor de 3 sets",
        "2sets-super": "2 Sets + Super Tie-break",
        "tiebreak": "Solo Tie-break (7 puntos)",
        "super-tiebreak": "Solo Super Tie-break (10 puntos)",
        "quick": "Juego R√°pido (4 games)",
      };

      let gameTypeText = gameTypes[config.gameType] || "No seleccionado";
      if (config.gameType && config.gameType.startsWith("custom-")) {
        const numGames = config.gameType.split("-")[1];
        gameTypeText = `Personalizado (${numGames} games)`;
      }

      const scoringTypes = {
        golden: "Punto de Oro",
        advantage: "Con Ventaja",
      };

      const sideChangeTypes = {
        odd: "Juegos impares",
        set: "Final de set",
        none: "Sin cambio",
      };

      document.getElementById("teams-summary").innerHTML = `
        <p class="mb-2"><strong>Pareja 1:</strong> ${players.jugador1} / ${players.jugador2}</p>
        <p><strong>Pareja 2:</strong> ${players.jugador3} / ${players.jugador4}</p>
      `;

      const tournamentEl = document.getElementById("tournamentMode");
      const isTournament = tournamentEl ? tournamentEl.checked : false;

      document.getElementById("format-summary").innerHTML = `
        <p class="mb-2"><strong>Tipo:</strong> ${gameTypeText}</p>
        <p><strong>Puntuaci√≥n:</strong> ${scoringTypes[config.scoring] || "No seleccionado"}</p>
        <p><strong>Cambio lado:</strong> ${sideChangeTypes[config.sideChange] || "No seleccionado"}</p>
        <p><strong>Modo Torneo:</strong> ${isTournament ? "Activado" : "Desactivado"}</p>
      `;
    }

    // =========================
    // Iniciar Partido (MQTT + Local)
    // =========================
    async function startMatch() {
      closeConfirmModal();

      const players = {
        jugador1: document.getElementById("jugador1").value.trim(),
        jugador2: document.getElementById("jugador2").value.trim(),
        jugador3: document.getElementById("jugador3").value.trim(),
        jugador4: document.getElementById("jugador4").value.trim(),
      };

      if (!players.jugador1 || !players.jugador2 || !players.jugador3 || !players.jugador4) {
        alert("Por favor, completa todos los nombres de los jugadores.");
        return;
      }
      if (!config.gameType || !config.scoring || !config.sideChange) {
        alert("Por favor, completa toda la configuraci√≥n del partido antes de iniciar.");
        return;
      }

      const tournamentEl = document.getElementById("tournamentMode");
      const isTournament = tournamentEl ? tournamentEl.checked : false;

      // params para LOCAL (ESP32 AP)
      const params = new URLSearchParams();
      params.append("a_first", players.jugador1);
      params.append("a_last", players.jugador2);
      params.append("b_first", players.jugador3);
      params.append("b_last", players.jugador4);
      params.append("gameType", config.gameType);
      params.append("scoring", config.scoring);
      params.append("sideChange", config.sideChange);
      params.append("tournamentMode", isTournament);

      // payload para MQTT (Internet)
      const payload = {
        a_first: players.jugador1,
        a_last: players.jugador2,
        b_first: players.jugador3,
        b_last: players.jugador4,
        gameType: config.gameType,
        scoring: config.scoring,
        sideChange: config.sideChange,
        tournamentMode: isTournament
      };

      const mqttOk = mqttSendConfig(payload);

      let localOk = false;
      try {
        await sendLocalConfig(params);
        localOk = true;
      } catch (e) {
        localOk = false;
      }

      if (mqttOk || localOk) {
        alert(
          "‚úÖ Configuraci√≥n enviada.\n\n" +
          (mqttOk ? "‚Ä¢ MQTT: OK (Internet)\n" : "‚Ä¢ MQTT: NO\n") +
          (localOk ? "‚Ä¢ Local: OK (ESP32)\n" : "‚Ä¢ Local: NO\n") +
          "\nRevisa la pantalla de la TV."
        );
      } else {
        alert(
          "‚ùå No se pudo enviar ni por MQTT ni local.\n\n" +
          "Revisa Console (F12) por errores.\n" +
          "Debe salir: '‚úÖ MQTT conectado a HiveMQ Cloud'."
        );
      }
    }

    // =========================
    // Reset Config
    // =========================
    function resetConfig() {
      config = {
        players: {},
        gameType: "3sets",
        scoring: "golden",
        countingMethod: "players",
        sideChange: "set",
        tournamentMode: false,
      };

      const form = document.getElementById("configuracionForm");
      if (form) form.reset();

      const cg = document.getElementById("customGames");
      if (cg) cg.value = "";

      document.getElementById("game-type-summary-title").textContent = "Al mejor de 3";
      document.getElementById("game-type-summary-desc").textContent = "Formato cl√°sico (por defecto)";

      setSegmentSelected("#scoring-golden, #scoring-advantage", "scoring-golden");
      setSegmentSelected("#side-odd, #side-set, #side-none", "side-set");

      const tournamentEl = document.getElementById("tournamentMode");
      if (tournamentEl) tournamentEl.checked = false;

      updateSummary();
    }

    // =========================
    // Modal confirmaci√≥n
    // =========================
    function openConfirmModal(evt) {
      document.body.classList.add("modal-open");
      if (evt) evt.preventDefault();

      const players = {
        jugador1: document.getElementById("jugador1").value.trim(),
        jugador2: document.getElementById("jugador2").value.trim(),
        jugador3: document.getElementById("jugador3").value.trim(),
        jugador4: document.getElementById("jugador4").value.trim(),
      };

      if (!players.jugador1 || !players.jugador2 || !players.jugador3 || !players.jugador4) {
        alert("Por favor, completa todos los nombres de los jugadores.");
        return;
      }
      if (!config.gameType || !config.scoring || !config.sideChange) {
        alert("Por favor, completa toda la configuraci√≥n del partido.");
        return;
      }

      updateSummary();
      document.getElementById("confirmModal").classList.remove("hidden");
    }

    function closeConfirmModal() {
      document.body.classList.remove("modal-open");
      document.getElementById("confirmModal").classList.add("hidden");
    }

    // =========================
    // Tabs
    // =========================
    function switchTab(tabName) {
      document.querySelectorAll(".content-section").forEach((section) => section.classList.remove("active"));
      document.querySelectorAll('[id^="tab-"]').forEach((tab) => {
        tab.classList.remove("tab-active");
        tab.classList.add("tab-inactive");
      });

      const section = document.getElementById(`${tabName}-tab`);
      if (section) section.classList.add("active");

      const tabBtn = document.getElementById(`tab-${tabName}`);
      if (tabBtn) {
        tabBtn.classList.remove("tab-inactive");
        tabBtn.classList.add("tab-active");
      }
    }

    // =========================
    // Estad√≠sticas (demo)
    // =========================
    function showFullStats() { alert("Demo: Historial completo (pendiente)"); }
    function showBasicStats() { alert("Demo: Resumen (pendiente)"); }

    // =========================
    // Auth (demo)
    // =========================
    function showLoginForm() { switchTab("perfil"); }

    function showRegisterForm() { switchTab("perfil"); }

    function handleLogin(evt) {
      evt.preventDefault();
      isLoggedIn = true;
      updateStatsView();
      alert("Login demo: OK");
    }

    function handleRegister(evt) {
      evt.preventDefault();
      isLoggedIn = true;
      updateStatsView();
      alert("Registro demo: OK");
    }

    function handleLogout() {
      isLoggedIn = false;
      updateStatsView();
      alert("Sesi√≥n cerrada");
    }

    function updateStatsView() {
      const noLogin = document.getElementById("stats-no-login");
      const withLogin = document.getElementById("stats-with-login");
      if (!noLogin || !withLogin) return;

      if (isLoggedIn) {
        noLogin.classList.add("hidden");
        withLogin.classList.remove("hidden");
      } else {
        noLogin.classList.remove("hidden");
        withLogin.classList.add("hidden");
      }
    }

    // =========================
    // Init
    // =========================
    document.addEventListener("DOMContentLoaded", function () {
      mqttConnect();
      updateStatsView();

      document.querySelectorAll('input[type="text"]').forEach((input) => {
        input.addEventListener("input", updateSummary);
      });

      setSegmentSelected("#scoring-golden, #scoring-advantage", "scoring-golden");
      setSegmentSelected("#side-odd, #side-set, #side-none", "side-set");

      const tournamentEl = document.getElementById("tournamentMode");
      if (tournamentEl) tournamentEl.addEventListener("change", updateSummary);

      try {
        const isMobile = window.matchMedia && window.matchMedia("(max-width: 640px)").matches;
        if (isMobile) {
          setTimeout(() => {
            const banner = document.getElementById("download-banner");
            if (banner) banner.classList.remove("hidden");
          }, 4000);
        }
      } catch (e) {}

      updateSummary();
    });
  </script>
</body>
</html>
